
- hosts: localhost
  become: yes
  become_user: root
  name: "Cluster resource testing"
  tasks:
    - name: "Ensure cluster resource is absent"
      cluster_resource:
        state: absent
        name: rsc_st_azure
        resource_class: stonith
        resource_type: fence_azure_arm
        options: |
          pcmk_monitor_retries=4
          pcmk_action_limit=3
          power_timeout=240
          pcmk_reboot_timeout=900
      register: resultobj
    - name: Dump the result object
      debug:
        msg: '{{ resultobj }}'

    - name: "Create cluster resource"
      cluster_resource:
        state: present
        name: rsc_st_azure
        resource_class: stonith
        resource_type: fence_azure_arm
        options: |
          pcmk_monitor_retries=4
          pcmk_action_limit=3
          power_timeout=240
          pcmk_reboot_timeout=900
      register: resultobj
    - name: Dump the result object
      debug:
        msg: '{{ resultobj }}'

    - name: "Ensure idempotence"
      cluster_resource:
        state: present
        name: rsc_st_azure
        resource_class: stonith
        resource_type: fence_azure_arm
        options: |
          pcmk_monitor_retries=4
          pcmk_action_limit=3
          power_timeout=240
          pcmk_reboot_timeout=900
      register: resultobj
    - name: Dump the result object
      debug:
        msg: '{{ resultobj }}'

    - name: "Modify the resource"
      cluster_resource:
        state: present
        name: rsc_st_azure
        resource_class: stonith
        resource_type: fence_azure_arm
        options: |
          pcmk_monitor_retries=4
          pcmk_action_limit=3
          power_timeout=240
          pcmk_reboot_timeout=900
      register: resultobj
    - name: Dump the result object
      debug:
        msg: '{{ resultobj }}'

    - name: "Try removing nonexistent resource"
      cluster_resource:
        state: absent
        name: idontexist
        resource_class: stonith
        resource_type: fence_azure_arm
        options: |
          pcmk_monitor_retries=4
          pcmk_action_limit=3
          power_timeout=240
          pcmk_reboot_timeout=900
      register: resultobj
    - name: Dump the result object
      debug:
        msg: '{{ resultobj }}'
      